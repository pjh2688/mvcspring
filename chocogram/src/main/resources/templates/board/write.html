<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" th:href="@{/assets/css/style.css}">
	<link rel="stylesheet" th:href="@{/assets/plugin/bootstrap/css/bootstrap.min.css}">
</head>
<body>
	<div class="fixed-navbar">
		<div class="pull-left">
			<h1 class="page-title">BOARD</h1>
		</div>
	</div>
	<div id="wrapper">
		<div class="main-content">
			<div class="row row-inline-block small-spacing">
				<div class="col-xs-12">
					<div class="box-content">
						<div class="clearfix">
							<h4 class="box-title pull-left"></h4>
						</div>
					
					
						<div class="card-content" style="display: table; width: 700px; margin: 0 auto;">
							<form id="form" class="form-horizontal">
								<div class="form-group">
									<label for="title" class="col-sm-2 control-label">제목</label>
									<div class="col-sm-10">
										<input type="text" id="title" class="form-control" placeholder="제목을 입력해 주세요." />
									</div> 
								</div>
							
								<div class="form-group">
									<label for="writer" class="col-sm-2 control-label">이름</label>
									<div class="col-sm-10">
										<input type="text" id="writer" class="form-control" placeholder="이름을 입력해 주세요." />
									</div>
								</div>
							
								<div class="form-group">
									<label for="content" class="col-sm-2 control-label">내용</label>
									<div class="col-sm-10">
										<textarea id="content" class="form-control" placeholder="이름을 입력해 주세요."></textarea>
									</div>
								</div>
							
								<div class="btn_wrap text-center">
									<button type="button" th:onclick="save();" class="btn btn-primary waves-effect waves-light">저장하기</button>
									<a th:href="@{/board/list}" class="btn btn-default waves-effect waves-light">뒤로가기</a>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		
			<footer class="footer">
				<ul class="list-inline">
					<li>2022  ⓒ JADECROSS Admin.</li>
				</ul>
			</footer>
		</div>
	</div>
	
	<script th:src="@{/assets/scripts/jquery.min.js}"></script>
	<script th:src="@{/assets/plugin/bootstrap/js/bootstrap.min.js}"></script>
	<script th:inline="javascript">
	/*<![CDATA[*/
		/* 1. 유효성 검사 */
		function isValid() {
			const form = document.getElementById('form');
			
			if(!form.title.value.trim()) {
				alert('제목을 입력해주세요.');
				form.title.value = '';
				form.title.focus();
				return false;
			}
			
			if(!form.writer.value.trim()) {
				alert('작성자을 입력해주세요.');
				form.writer.value = '';
				form.writer.focus();
				return false;
			}
			
			if(!form.content.value.trim()) {
				alert('내용을 입력해주세요.');
				form.content.value = '';
				form.content.focus();
				return false;
			}
			
			return true;
		}
		
		/* 2. 게시글 등록(create/update) */
		function save() {
			if(!isValid()) {
				return false;
			}
			
			const form = document.getElementById('form');
			
			const params = {
				title: form.title.value,
				writer: form.writer.value,
				content: form.content.value,
				deleteYn: 'N'
			};
			
			$.ajax({
				data: JSON.stringify(params),
				url: "/api/boards",
				type: "POST",
				dataType: "json",
				contentType: "application/json; charset=UTF-8",
				success: function(res) {
					
					if(!res) {
						throw new Error('Request failed');
					}
					
					alert('저장되었습니다.');
					
					goList();
				},
				error: function() {
					alert('오류가 발생하였습니다.');
					goList();
				}
			});
		}
		
		function goList() {
			location.href = '/board/list' + location.search;
		}
		/*]]>*/
	</script>
	
	
</body>
</html>